# クロスステッチ図案生成ツール 仕様書

## 🎯 概要

本ツールは、画像からクロスステッチ図案を自動生成し、使用される刺繍糸の色をDMCまたはCOSMOのマスターデータに基づいて割り当て、最終的に買い物リストとして出力できるWebツールです。DBは使用せず、JSONファイルを元にローカルで完結します。

---

## 📌 対応ブランド

* DMC（マスターデータ済）
* COSMO（マスターデータ済）

> Anchorは現在非対応（2025年6月時点）

---

## 🧱 使用技術（予定）

* フロントエンド: SvelteKit（タブレット・PC閲覧を主対象）
* データ保存形式: JSONファイル
* 保存手段: ユーザーの localStorage または ファイルダウンロード
* 画像処理: JavaScript Canvas API

---

## 🔁 処理の流れ

1. **画像アップロード**

    * PNG/JPEGなどの画像を選択

2. **グリッド設定**

    * 横×縦のマス数を指定（例: 50x50）

3. **代表色抽出**

    * 各グリッド単位で平均色または中央ピクセルのRGBを取得

4. **色マッチング**

    * DMCまたはCOSMOのマスターデータとRGBを比較し、最も近い色を選定（RGB距離による）

5. **図案生成**

    * グリッドごとに色番号付きの図案（SVGまたはHTML）を生成
    * カラーパレットも同時表示
    * 図案はSVGまたはPNGとしてダウンロード可能

6. **買い物リスト作成**

    * 使用色ごとの出現数を元に推定本数を計算
    * ブランド別リストを生成し、UI表示／CSV出力／印刷可能
    * リストはCSV/JSON形式でダウンロード可能

---

## 🗂️ データ構造（JSON）

### 🔹 マスターデータ例（`dmc_raw.json`）

```json
{
  "155": {
    "BRAND": "DMC",
    "COLOR_CODE": "155",
    "COLOR_NAME_EN": "Forget-me-not Blue",
    "RGB_COLOR": "#9774b6",
    "RGB": [151, 116, 182],
    "HSV": [272, 36, 71]
  }
}
```

### 🔹 図案出力（`pattern.json`）例

```json
{
  "gridSize": [50, 50],
  "brand": "DMC",
  "cells": [
    ["310", "321", "321"],
    ["310", "310", "321"]
  ]
}
```

### 🔹 買い物リスト（`shopping_list.json`）例

```json
{
  "brand": "DMC",
  "threads": [
    { "code": "310", "count": 2 },
    { "code": "321", "count": 4 }
  ]
}
```

---

## 🔧 今後の拡張予定

* 図案の共有機能（共有用URL生成またはJSONエクスポート）
* クロス変換（DMC→COSMOの類似変換）
* 記号付き図案の自動生成

---

## 📄 補足

* オフライン完結（データはブラウザ内で処理）
* ユーザーの操作ミス防止のため、マス数や変換回数に制限あり
* タブレットおよびPCでの閲覧に最適化されたUIを前提とする

---

（最終更新日: 2025年6月26日）
